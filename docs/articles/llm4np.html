<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>llm4np: language modeling for neuropsychology reports • llm4np</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="llm4np: language modeling for neuropsychology reports">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">llm4np</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/llm4np.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/vjcitn/llm4np/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>llm4np: language modeling for neuropsychology reports</h1>
                        <h4 data-toc-skip class="author">Vincent J. Carey, stvjc at channing.harvard.edu</h4>
            
            <h4 data-toc-skip class="date">June 28, 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vjcitn/llm4np/blob/HEAD/vignettes/llm4np.Rmd"><code>vignettes/llm4np.Rmd</code></a></small>
      <div class="d-none name"><code>llm4np.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We use the <a href="https://github.com/lawremi/wizrd" class="external-link">wizrd</a> package to produce tooling for condensation and ontological tagging of neuropsychology reports.</p>
<div class="section level3">
<h3 id="using-gpt-4-1-mini-to-condense-an-example-report">Using gpt-4.1-mini to condense an example report<a class="anchor" aria-label="anchor" href="#using-gpt-4-1-mini-to-condense-an-example-report"></a>
</h3>
<p>For this code to run without modifications, environment variable <code>OPENAI_API_KEY</code> must have a valid setting.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OPENAI_API_KEY"</span><span class="op">)</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lawremi/wizrd" class="external-link">wizrd</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vjcitn/llm4np">llm4np</a></span><span class="op">)</span></span>
<span><span class="va">pretty_rmd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/strwrap.html" class="external-link">strwrap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"&gt;"</span>, text <span class="op">=</span> <span class="va">_</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We have retrieved an example PDF of a neuropsychological (NP) evaluation from <a href="https://static1.squarespace.com/static/50a3e393e4b07025e1a4f0d0/t/510b1429e4b0f6b4fb681381/1359680553898/de-identified+report+1.pdf" class="external-link">squarespace.com</a>.</p>
<p><strong>Note:</strong> The <code>parse_nppdf</code> may emit warnings or errors during the table parsing phase. These refer to non-existent files, and seem to be false positives. They should be ignored.</p>
<p><code>parse_nppdf</code> uses <code>pdftools</code> and <code>tabulapdf</code> to extract text and tables from reports.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deidpath</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"pdfs"</span>, <span class="st">"de-identified+report+1.pdf"</span>, package<span class="op">=</span><span class="st">"llm4np"</span><span class="op">)</span></span>
<span><span class="va">deid</span> <span class="op">=</span> <span class="fu"><a href="../reference/parse_nppdf.html">parse_nppdf</a></span><span class="op">(</span><span class="va">deidpath</span><span class="op">)</span></span>
<span><span class="va">deid</span></span></code></pre></div>
<pre><code><span><span class="co">## Parsed NP pdf with 7 pages and 9 tables.</span></span></code></pre>
<p>We paste the report text into a single character vector for convenient processing.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\n"</span>, <span class="st">" "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">deid</span><span class="op">@</span><span class="va">text</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">nt</span>,<span class="fl">1130</span>,<span class="fl">1210</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] " Tests of Visual Motor Integration (VMI) and Visual Perception (VP); Gray Oral Re"</span></span></code></pre>
<p>We also have a view of an autism ontology based on a <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC4000751/" class="external-link">2015 paper</a> by Alexa McCray and colleages.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nmdf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nmdf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         tag                                           val</span></span>
<span><span class="co">## 1 Class_634                 Obstetric Delivery Procedures</span></span>
<span><span class="co">## 2 Class_385                             Perinatal History</span></span>
<span><span class="co">## 3 Class_464 Attention Deficit Disorder with Hyperactivity</span></span>
<span><span class="co">## 4 Class_455                              Mental Disorders</span></span>
<span><span class="co">## 5 Class_689                   Psychiatric Hospitalization</span></span>
<span><span class="co">## 6 Class_138                       Psychologic Indications</span></span></code></pre>
<p>Now we create an agent that will be prompted to use the ontology in a summary of the NP evaluation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ag</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/model-constructors.html" class="external-link">openai_agent</a></span><span class="op">(</span><span class="st">"gpt-4.1-mini-2025-04-14"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/instruct.html" class="external-link">instruct</a></span><span class="op">(</span><span class="st">"You are a helpful assistant with training in neuropsychology."</span><span class="op">)</span></span>
<span><span class="va">ag</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;wizrd::Agent&gt; gpt-4.1-mini-2025-04-14</span></span>
<span><span class="co">## @instructions: You are a helpful assistant with training in neuropsychology.</span></span>
<span><span class="co">## @io: &lt;wizrd::PlainTextFormat&gt; → ← &lt;wizrd::PlainTextFormat&gt;</span></span>
<span><span class="co">## @tools: </span></span>
<span><span class="co">## @params: </span></span>
<span><span class="co">## @backend: &lt;wizrd::OpenAIAPIServer&gt; https://api.openai.com</span></span></code></pre>
<p>We now use a templated prompt, using the report text and the ontology in a summary.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prompted_agent</span> <span class="op">&lt;-</span> <span class="va">ag</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/prompt_as.html" class="external-link">prompt_as</a></span><span class="op">(</span></span>
<span><span class="st">"Please summarize the text {txt} in five short paragraphs of at most 45 words.</span></span>
<span><span class="st">Use the concepts in the 'val' field of {df} as much as possible, choosing the most specific</span></span>
<span><span class="st">term that is relevant.  Do not interrupt your summary with any references to the</span></span>
<span><span class="st">vocabulary 'tag' or 'val'.  After producing the  paragraphs, please produce three lists</span></span>
<span><span class="st">of at least five tags that were identified in your analysis of the report, corresponding</span></span>
<span><span class="st">to 'strengths',  'weaknesses' and 'needs' of the subject of the report.  Use headings with</span></span>
<span><span class="st">the lists and provide the lists as sentences  preceded by the category, and add</span></span>
<span><span class="st">the 'PTO:' prefix, 'tag', and 'val' values in parentheses for each item in each list.</span></span>
<span><span class="st">An example list item in Needs: would be '(PTO:Class_585, Medications)' to make very</span></span>
<span><span class="st">precise what term has been selected."</span><span class="op">)</span></span>
<span><span class="va">prompted_agent</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>txt<span class="op">=</span><span class="va">nt</span>, df<span class="op">=</span><span class="va">nmdf</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pretty_rmd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Joe is an 8-year-old boy with a history of premature birth, Tourette syndrome, and ADHD affecting attention and executive function. He exhibits reduced auditory and visual attention span, working memory challenges, and executive dysfunction impacting task performance and organization. His intellectual functioning is borderline with stronger verbal than nonverbal skills.</p>
<p>Despite attentional issues, Joe demonstrates effective spontaneous language and adequate verbal memory when supported, though his processing speed and comprehension are below age expectations. His motor skills show impaired fine motor control and balance, influenced by persistent motor tics and difficulties with graphomotor accuracy. Adaptive skills and study habits remain below expectations with noted struggles in planning and completing complex tasks independently.</p>
<p>Joe’s ability to integrate complex information across modalities is limited, contributing to challenges in academic achievement and daily functional independence. He requires consistent external support for task routines, organization, and self-regulation and benefits from structured, small group academic instruction, with accommodations such as workload reductions and extended time.</p>
<p>Significant behavioral improvements, likely related to medication, have been observed, though residual hyperactivity and tic behaviors persist. His learning difficulties are consistent with neurodevelopmental vulnerabilities linked to prematurity and neuropsychiatric conditions, requiring coordinated medical, psychiatric, and educational interventions.</p>
<p>Recommendations emphasize ongoing small group teaching, executive function support, preferential classroom seating, scheduled breaks, careful monitoring of workload, and continued pharmacological and behavioral management. Regular neuropsychological follow-ups are advised to monitor progress and adjust interventions accordingly.</p>
<p><strong>Strengths:</strong> - Joe communicates spontaneously and fluently, showing good verbal language skills (PTO:Class_376, Language Ability). - Verbal working memory performance is relatively intact under supported conditions (PTO:Class_176, Working Memory). - Joe participates well in sports activities, indicating preserved gross motor skills (PTO:Class_301, Gross Motor Skills). - Improvement in teacher-rated executive function scales and behavior since last evaluation (PTO:Class_455, Executive Function). - Adequate comprehension with multiple repetitions and structured support (PTO:Class_455, Receptive Language).</p>
<p><strong>Weaknesses:</strong> - Attention deficits impacting auditory and visual span, self-regulation, and task persistence (PTO:Class_163, Attention Deficit Disorder with Hyperactivity). - Borderline intellectual functioning with weaknesses in nonverbal reasoning and processing speed (PTO:Class_519, IQ). - Impaired fine motor skills and praxis with difficulties in handwriting and motor coordination (PTO:Class_301, Motor Skills). - Difficulty integrating complex multi-load information leading to task performance deterioration (PTO:Class_219, Adaptation to Task Complexity). - Below-average adaptive life skills, particularly in study skills and organizing materials (PTO:Class_340, Adaptive Life Skills).</p>
<p><strong>Needs:</strong> - Continued small group instruction focusing on reading, arithmetic, and executive functioning (PTO:Class_219, Reading and Writing). - External modeling and guided practice for multi-step routines and homework management (PTO:Class_455, Executive Function). - Classroom accommodations including preferential seating, reduced workload, extended time, and frequent breaks (PTO:Class_455, Task Completion). - Ongoing psychiatric and behavioral support for medication management and tic-related psychosocial impacts (PTO:Class_138, Medications). - Structured daily schedules and active prompts to enhance attention and assist with transitions and comprehension (PTO:Class_455, Planning).</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="a-second-example-using-gpt-4o-mini">A second example, using gpt-4o-mini<a class="anchor" aria-label="anchor" href="#a-second-example-using-gpt-4o-mini"></a>
</h3>
<p><strong>Note:</strong> The <code>parse_nppdf</code> may emit warnings or errors during the table parsing phase. These refer to non-existent files, and seem to be false positives. They should be ignored.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ag</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/model-constructors.html" class="external-link">openai_agent</a></span><span class="op">(</span><span class="st">"gpt-4o-mini"</span><span class="op">)</span> </span>
<span><span class="va">prompted_agent</span> <span class="op">&lt;-</span> <span class="va">ag</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/prompt_as.html" class="external-link">prompt_as</a></span><span class="op">(</span></span>
<span><span class="st">"Please summarize the text {txt} in three short paragraphs of at most 45 words.</span></span>
<span><span class="st">Use the concepts in the 'val' field of {df} as much as possible, choosing the most specific</span></span>
<span><span class="st">term that is relevant."</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pecspa</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"pdfs"</span>, <span class="st">"PECS-Example-ADHD-Report.pdf"</span>, package<span class="op">=</span><span class="st">"llm4np"</span><span class="op">)</span></span>
<span><span class="va">pecs</span> <span class="op">=</span> <span class="fu"><a href="../reference/parse_nppdf.html">parse_nppdf</a></span><span class="op">(</span><span class="va">pecspa</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: One or more parsing issues, call `problems()` on your data frame for details,</span></span>
<span><span class="co">## e.g.:</span></span>
<span><span class="co">##   dat &lt;- vroom(...)</span></span>
<span><span class="co">##   problems(dat)</span></span></code></pre>
<p>Error : ‘CONTENTS’ does not exist in current working directory (‘/Users/vincentcarey/AUTISM/llm4np/vignettes’). Error : ‘CURRENT CONCERNS’ does not exist in current working directory (‘/Users/vincentcarey/AUTISM/llm4np/vignettes’). Error : ‘CONCLUSION’ does not exist in current working directory (‘/Users/vincentcarey/AUTISM/llm4np/vignettes’).</p>
<pre><code><span><span class="co">## Warning: One or more parsing issues, call `problems()` on your data frame for details,</span></span>
<span><span class="co">## e.g.:</span></span>
<span><span class="co">##   dat &lt;- vroom(...)</span></span>
<span><span class="co">##   problems(dat)</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">txt2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\n"</span>, <span class="st">" "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">pecs</span><span class="op">@</span><span class="va">text</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">)</span>  <span class="co"># concatenate text</span></span>
<span><span class="va">prompted_agent</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>txt<span class="op">=</span><span class="va">txt2</span>, df<span class="op">=</span><span class="va">nmdf</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pretty_rmd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>The comprehensive ADHD report for John Smith is an assessment conducted by Dr. Shane Langsford, addressing concerns related to Attention Deficit Hyperactivity Disorder (ADHD) following a referral from a pediatrician. It outlines a thorough evaluation process, including behavioral assessments, socio-emotional evaluations, and cognitive testing, contributing to John’s primary diagnosis of ADHD, predominantly inattentive type.</p>
<p>The findings reveal significant difficulties in various areas, such as academic performance, attention, and memory, alongside a developmental history of expressive language challenges. The results indicate comorbidities with specific learning disorders affecting reading and writing, and high levels of anxiety and depression. Recommendations for further assessment and continuous support at home and school emphasize multi-faceted intervention strategies.</p>
</blockquote>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vince Carey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
