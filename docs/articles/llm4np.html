<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>llm4np: language modeling for neuropsychology reports • llm4np</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="llm4np: language modeling for neuropsychology reports">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">llm4np</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/llm4np.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>llm4np: language modeling for neuropsychology reports</h1>
                        <h4 data-toc-skip class="author">Vincent J. Carey, stvjc at channing.harvard.edu</h4>
            
            <h4 data-toc-skip class="date">June 20, 2025</h4>
      
      <small class="dont-index">Source: <a href="NA/NA/NA/blob/HEAD/vignettes/llm4np.Rmd"><code>vignettes/llm4np.Rmd</code></a></small>
      <div class="d-none name"><code>llm4np.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We use the <a href="https://github.com/lawremi/wizrd" class="external-link">wizrd</a> package to produce tooling for condensation and ontological tagging of neuropsychology reports.</p>
<div class="section level3">
<h3 id="using-gpt-4o-mini-to-condense-an-example-report">Using gpt-4o-mini to condense an example report<a class="anchor" aria-label="anchor" href="#using-gpt-4o-mini-to-condense-an-example-report"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lawremi/wizrd" class="external-link">wizrd</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vjcitn" class="external-link">llm4np</a></span><span class="op">)</span></span>
<span><span class="va">pretty_rmd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/strwrap.html" class="external-link">strwrap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"&gt;"</span>, text <span class="op">=</span> <span class="va">_</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We have retrieved an example PDF of a neuropsychological (NP) evaluation from <a href="https://www.thepeerconsult.com/_files/ugd/38c21a_34d817a3c29c43019ea07630ac486230.pdf" class="external-link">thepeerconsult.com</a>.</p>
<p><code>parse_nppdf</code> uses <code>pdftools</code> and <code>tabulapdf</code> to extract text and tables from reports.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nelsonasd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"pdfs"</span>, <span class="st">"nelsonAutDeid.pdf"</span>, package<span class="op">=</span><span class="st">"llm4np"</span><span class="op">)</span></span>
<span><span class="va">nels</span> <span class="op">=</span> <span class="fu"><a href="../reference/parse_nppdf.html">parse_nppdf</a></span><span class="op">(</span><span class="va">nelsonasd</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error : '4.  Educators are also likely to be best able to support George’s emotional, behavioral, and social functioning' does not exist in current working directory ('/Users/vincentcarey/AUTISM/llm4np/vignettes').</span></span>
<span><span class="co">## Error : '    ognitive Skills             ' does not exist in current working directory ('/Users/vincentcarey/AUTISM/llm4np/vignettes').</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nels</span></span></code></pre></div>
<pre><code><span><span class="co">## Parsed NP pdf with 14 pages and 5 tables.</span></span></code></pre>
<p>We paste the report text into a single character vector for convenient processing.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\n"</span>, <span class="st">" "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">nels</span><span class="op">@</span><span class="va">text</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">nt</span>, <span class="fl">1</span>, <span class="fl">35</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "                                   "</span></span></code></pre>
<p>We also have a view of an autism ontology based on a <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC4000751/" class="external-link">2015 paper</a> by Alexa McCray and colleages.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nmdf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nmdf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         tag                                           val</span></span>
<span><span class="co">## 1 Class_634                 Obstetric Delivery Procedures</span></span>
<span><span class="co">## 2 Class_385                             Perinatal History</span></span>
<span><span class="co">## 3 Class_464 Attention Deficit Disorder with Hyperactivity</span></span>
<span><span class="co">## 4 Class_455                              Mental Disorders</span></span>
<span><span class="co">## 5 Class_689                   Psychiatric Hospitalization</span></span>
<span><span class="co">## 6 Class_138                       Psychologic Indications</span></span></code></pre>
<p>Now we create an agent that will be prompted to use the ontology in a summary of the NP evaluation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ag</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/model-constructors.html" class="external-link">openai_agent</a></span><span class="op">(</span><span class="st">"gpt-4o-mini"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/instruct.html" class="external-link">instruct</a></span><span class="op">(</span><span class="st">"You are a helpful assistant with training in neuropsychology."</span><span class="op">)</span></span>
<span><span class="va">ag</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;wizrd::Agent&gt; gpt-4o-mini</span></span>
<span><span class="co">## @instructions: You are a helpful assistant with training in neuropsychology.</span></span>
<span><span class="co">## @io: &lt;wizrd::PlainTextFormat&gt; → ← &lt;wizrd::PlainTextFormat&gt;</span></span>
<span><span class="co">## @tools: </span></span>
<span><span class="co">## @params: </span></span>
<span><span class="co">## @backend: &lt;wizrd::OpenAIAPIServer&gt; https://api.openai.com</span></span></code></pre>
<p>We now use a templated prompt, using the report text and the ontology in a summary.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prompted_agent</span> <span class="op">&lt;-</span> <span class="va">ag</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/prompt_as.html" class="external-link">prompt_as</a></span><span class="op">(</span><span class="st">"Please summarize the text {txt} in five short paragraphs </span></span>
<span><span class="st">    of at most 45 words.  Use the </span></span>
<span><span class="st">    concepts in the 'val' field of {df} as much as possible, choosing the</span></span>
<span><span class="st">    most specific term that is relevant, and when</span></span>
<span><span class="st">    you do use these terms, please append the associated value of the 'tag' field</span></span>
<span><span class="st">    in parentheses, prefixing the tag with 'PTO:'.  After producing the paragraphs,</span></span>
<span><span class="st">    please produce three lists of tags that were used, corresponding to </span></span>
<span><span class="st">    'strengths', 'weaknesses' and 'needs'.  Do not use headings with the lists, just provide</span></span>
<span><span class="st">    the lists as sentences preceded by the category."</span><span class="op">)</span> </span>
<span><span class="va">prompted_agent</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>txt<span class="op">=</span><span class="va">nt</span>, df<span class="op">=</span><span class="va">nmdf</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pretty_rmd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>George Smith, a 12-year-old boy, is identified as highly gifted but faces challenges related to autism (PTO: Autism Phenotype), ADHD (PTO: Attention Deficit Disorder with Hyperactivity), and anxiety (PTO: Anxiety). His cognitive strengths, particularly in problem-solving (PTO: Problem Solving Ability) and working memory (PTO: Working Memory), support his academic achievements, placing him at a high school graduate level in basic skills (PTO: Performance in School).</p>
<p>Despite remarkable cognitive abilities, George’s fine motor skills (PTO: Fine Motor Skills) and processing speed (PTO: Task Performance) are notably vulnerable. He struggles with social perception (PTO: Recognition of Social Norms) and interpersonal interactions (PTO: Interpersonal Interactions), impacting his ability to build connections (PTO: Social Competence) and engage with peers effectively (PTO: Participation in Play Activities).</p>
<p>George benefits from structured learning environments that accommodate his cognitive needs while providing routine (PTO: Adherence to Rules in the Home) and emotional support. Continued access to therapeutic services (PTO: Comorbidities), including social skills groups (PTO: Social Interest) and individualized education (PTO: Diagnosis), will aid his development in social and emotional domains.</p>
<p>In therapy, George is encouraged to work on emotional regulation (PTO: Emotional Regulation and Control) and coping skills (PTO: Managing Internal Emotions). Support for academic tasks, focusing on his interests (PTO: Intense Interests) and providing extra time (PTO: Processing Speed), will help nurture his exceptional potential as he navigates social and emotional challenges effectively.</p>
<p>Ongoing collaboration between parents, educators, and therapists is vital for George’s progress (PTO: Medical History). Adaptive strategies within school and home settings are essential to bolster his strengths while addressing vulnerabilities (PTO: Executive Function), ensuring a balanced approach to his overall development.</p>
<p>Strengths: Problem Solving Ability (PTO: Problem Solving Ability), Working Memory (PTO: Working Memory), Intense Interests (PTO: Intense Interests), Performance in School (PTO: Performance in School), Adherence to Rules in the Home (PTO: Adherence to Rules in the Home).</p>
<p>Weaknesses: Autism Phenotype (PTO: Autism Phenotype), Attention Deficit Disorder with Hyperactivity (PTO: Attention Deficit Disorder with Hyperactivity), Fine Motor Skills (PTO: Fine Motor Skills), Task Performance (PTO: Task Performance), Recognition of Social Norms (PTO: Recognition of Social Norms), Interpersonal Interactions (PTO: Interpersonal Interactions), Processing Speed (PTO: Processing Speed).</p>
<p>Needs: Medical History (PTO: Medical History), Comorbidities (PTO: Comorbidities), Social Interest (PTO: Social Interest), Emotional Regulation and Control (PTO: Emotional Regulation and Control), Executive Function (PTO: Executive Function).</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="a-second-example-no-autism-diagnosis-present">A second example, no autism diagnosis present<a class="anchor" aria-label="anchor" href="#a-second-example-no-autism-diagnosis-present"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqspf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"pdfs"</span>, <span class="st">"de-identified+report+1.pdf"</span>, package<span class="op">=</span><span class="st">"llm4np"</span><span class="op">)</span></span>
<span><span class="va">sq</span> <span class="op">=</span> <span class="fu"><a href="../reference/parse_nppdf.html">parse_nppdf</a></span><span class="op">(</span><span class="va">sqspf</span><span class="op">)</span></span>
<span><span class="va">txt2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\n"</span>, <span class="st">" "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">sq</span><span class="op">@</span><span class="va">text</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">)</span>  <span class="co"># concatenate text</span></span>
<span><span class="va">prompted_agent</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>txt<span class="op">=</span><span class="va">txt2</span>, df<span class="op">=</span><span class="va">nmdf</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pretty_rmd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Joe, an 8-year-old boy with a history of premature birth, Tourette syndrome, and ADHD, currently shows challenges with attention and functioning in an academic setting. His past assessments revealed a consistent need for support, reflecting his vulnerabilities linked to neurodevelopmental disorders, particularly in managing hyperactivity and completing multi-step tasks (PTO: Attention Deficit Disorder with Hyperactivity).</p>
<p>Observations from his assessment indicated engaging interpersonal skills and a cheerful demeanor. However, Joe frequently struggled with concentration, often losing track of instructions and requiring redirection, which highlights difficulties in executive function processes essential for academic success (PTO: Executive Function).</p>
<p>The findings from standardized tests place Joe’s cognitive abilities in the borderline range, with a Full Scale IQ of 75, suggesting a decline from previous assessments. Notably, he displayed stronger verbal skills compared to visual processing capabilities, impacting his overall performance and adaptability in learning environments (PTO: Cognitive Ability).</p>
<p>Joe’s language abilities are variable, showing challenges in both receptive and expressive capacities, particularly when under attention demands. He displays vocal tics and struggles with complex tasks requiring integration of information across modalities, reflecting a need for tailored academic support strategies (PTO: Language Ability).</p>
<p>Overall, Joe needs structured interventions focusing on improving attention strategies, executive function support, and personalized educational accommodations to foster independence and manage his neuropsychological challenges more effectively in a school setting (PTO: Performance in School).</p>
<p>Strengths include: Attention to detail (PTO: Planning), Engaging interpersonal skills (PTO: Reciprocity), Cheerful demeanor (PTO: Mood), Strong verbal knowledge base (PTO: Cognitive Ability), Participation in sports (PTO: Use of Free Time).</p>
<p>Weaknesses encompass: Difficulty with attention and focus (PTO: Attention and Focus), Variable language abilities (PTO: Language Ability), Executive function deficits (PTO: Executive Function), Motor control challenges (PTO: Motor Skills), Low processing speed (PTO: Cognitive Ability).</p>
<p>Needs: Consistent support with executive functions (PTO: Executive Function), Strategies for task initiation and completion (PTO: Task Completion), Instruction in small group settings (PTO: Performance in School), Behavioral management for tics (PTO: Tics and Mannerisms), Tailored academic schedules (PTO: Planning).</p>
</blockquote>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vince Carey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
