<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>llm4np: language modeling for neuropsychology reports • llm4np</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="llm4np: language modeling for neuropsychology reports">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">llm4np</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/llm4np.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>llm4np: language modeling for neuropsychology reports</h1>
                        <h4 data-toc-skip class="author">Vincent J. Carey, stvjc at channing.harvard.edu</h4>
            
            <h4 data-toc-skip class="date">June 19, 2025</h4>
      
      <small class="dont-index">Source: <a href="NA/NA/NA/blob/HEAD/vignettes/llm4np.Rmd"><code>vignettes/llm4np.Rmd</code></a></small>
      <div class="d-none name"><code>llm4np.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We use the <a href="https://github.com/lawremi/wizrd" class="external-link">wizrd</a> package to produce tooling for condensation and ontological tagging of neuropsychology reports.</p>
<div class="section level3">
<h3 id="using-gpt-4o-mini-to-condense-an-example-report">Using gpt-4o-mini to condense an example report<a class="anchor" aria-label="anchor" href="#using-gpt-4o-mini-to-condense-an-example-report"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lawremi/wizrd" class="external-link">wizrd</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vjcitn" class="external-link">llm4np</a></span><span class="op">)</span></span>
<span><span class="va">pretty_rmd</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/strwrap.html" class="external-link">strwrap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"&gt;"</span>, text <span class="op">=</span> <span class="va">_</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We have retrieved an example PDF of a neuropsychological (NP) evaluation from <a href="https://www.thepeerconsult.com/_files/ugd/38c21a_34d817a3c29c43019ea07630ac486230.pdf" class="external-link">thepeerconsult.com</a>.</p>
<p><code>parse_nppdf</code> uses <code>pdftools</code> and <code>tabulapdf</code> to extract text and tables from reports.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nelsonasd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"pdfs"</span>, <span class="st">"nelsonAutDeid.pdf"</span>, package<span class="op">=</span><span class="st">"llm4np"</span><span class="op">)</span></span>
<span><span class="va">nels</span> <span class="op">=</span> <span class="fu"><a href="../reference/parse_nppdf.html">parse_nppdf</a></span><span class="op">(</span><span class="va">nelsonasd</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error : '4.  Educators are also likely to be best able to support George’s emotional, behavioral, and social functioning' does not exist in current working directory ('/Users/vincentcarey/AUTISM/llm4np/vignettes').</span></span>
<span><span class="co">## Error : '    ognitive Skills             ' does not exist in current working directory ('/Users/vincentcarey/AUTISM/llm4np/vignettes').</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nels</span></span></code></pre></div>
<pre><code><span><span class="co">## Parsed NP pdf with 14 pages and 5 tables.</span></span></code></pre>
<p>We paste the report text into a single character vector for convenient processing.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\n"</span>, <span class="st">" "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">nels</span><span class="op">@</span><span class="va">text</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">nt</span>, <span class="fl">1</span>, <span class="fl">35</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "                                   "</span></span></code></pre>
<p>We also have a view of an autism ontology based on a <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC4000751/" class="external-link">2015 paper</a> by Alexa McCray and colleages.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nmdf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nmdf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         tag                                           val</span></span>
<span><span class="co">## 1 Class_634                 Obstetric Delivery Procedures</span></span>
<span><span class="co">## 2 Class_385                             Perinatal History</span></span>
<span><span class="co">## 3 Class_464 Attention Deficit Disorder with Hyperactivity</span></span>
<span><span class="co">## 4 Class_455                              Mental Disorders</span></span>
<span><span class="co">## 5 Class_689                   Psychiatric Hospitalization</span></span>
<span><span class="co">## 6 Class_138                       Psychologic Indications</span></span></code></pre>
<p>Now we create an agent that will be prompted to use the ontology in a summary of the NP evaluation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ag</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/model-constructors.html" class="external-link">openai_agent</a></span><span class="op">(</span><span class="st">"gpt-4o-mini"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/instruct.html" class="external-link">instruct</a></span><span class="op">(</span><span class="st">"You are a helpful assistant with training in neuropsychology."</span><span class="op">)</span></span>
<span><span class="va">ag</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;wizrd::Agent&gt; gpt-4o-mini</span></span>
<span><span class="co">## @instructions: You are a helpful assistant with training in neuropsychology.</span></span>
<span><span class="co">## @io: &lt;wizrd::PlainTextFormat&gt; → ← &lt;wizrd::PlainTextFormat&gt;</span></span>
<span><span class="co">## @tools: </span></span>
<span><span class="co">## @params: </span></span>
<span><span class="co">## @backend: &lt;wizrd::OpenAIAPIServer&gt; https://api.openai.com</span></span></code></pre>
<p>We now use a templated prompt, using the report text and the ontology in a summary.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prompted_agent</span> <span class="op">&lt;-</span> <span class="va">ag</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/wizrd/man/prompt_as.html" class="external-link">prompt_as</a></span><span class="op">(</span><span class="st">"Please summarize the text {txt} in five short paragraphs </span></span>
<span><span class="st">    of at most 45 words.  Use the </span></span>
<span><span class="st">    concepts in the 'val' field of {df} as much as possible, choosing the</span></span>
<span><span class="st">    most specific term that is relevant, and when</span></span>
<span><span class="st">    you do use these terms, please append the associated value of the 'tag' field</span></span>
<span><span class="st">    in parentheses, prefixing the tag with 'PTO:'.  After producing the paragraphs,</span></span>
<span><span class="st">    please produce three lists of tags that were used, corresponding to </span></span>
<span><span class="st">    'strengths', 'weaknesses' and 'needs'.  Do not use headings with the lists, just provide</span></span>
<span><span class="st">    the lists as sentences preceded by the category."</span><span class="op">)</span> </span>
<span><span class="va">prompted_agent</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>txt<span class="op">=</span><span class="va">nt</span>, df<span class="op">=</span><span class="va">nmdf</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pretty_rmd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>George Smith, a highly gifted 12-year-old, faces challenges in social skills, executive functioning, and emotional regulation, affecting his overall potential. Diagnosed with Autism Spectrum Disorder Level 1 (PTO:Primary Diagnosis), ADHD (PTO:Attention Deficit Disorder with Hyperactivity), and anxiety (PTO:Anxiety), he requires tailored support.</p>
<p>His remarkable strengths include superior verbal and nonverbal problem-solving abilities (PTO:Cognitive Ability), alongside an exceptional verbal memory (PTO:Working Memory) and strong language skills. These attributes facilitate understanding and communication when interacting with structured and clear information.</p>
<p>Nevertheless, George exhibits weaknesses in motor skills (PTO:Fine Motor Skills), processing speed (PTO:Task Performance), and emotional regulation (PTO:Emotional Regulation and Control). His difficulty with transitions and challenges in social reciprocity hinder his ability to connect with peers despite his intelligence (PTO:Social Competence).</p>
<p>To support George, ongoing interventions focusing on emotional development (PTO:Emotional Regulation and Control), social skills training (PTO:Social Competence), and executive functioning are crucial. A structured and predictable learning environment (PTO:Planning) will help nurture his strengths while addressing areas of need.</p>
<p>The evaluation indicates George would significantly benefit from continued occupational therapy (PTO:Motor Skills) and participation in social skills groups (PTO:Engaging in Social Activities), fostering engagement with peers where he can practice and refine his social skills.</p>
<p>Strengths include: Cognitive Ability (PTO:Cognitive Ability), Working Memory (PTO:Working Memory), Social Competence (PTO:Social Competence), Emotional Regulation and Control (PTO:Emotional Regulation and Control).</p>
<p>Weaknesses include: Fine Motor Skills (PTO:Fine Motor Skills), Task Performance (PTO:Task Performance), Emotional Regulation and Control (PTO:Emotional Regulation and Control), Social Competence (PTO:Social Competence).</p>
<p>Needs include: Primary Diagnosis (PTO:Primary Diagnosis), Attention Deficit Disorder with Hyperactivity (PTO:Attention Deficit Disorder with Hyperactivity), Motor Skills (PTO:Motor Skills), Engaging in Social Activities (PTO:Engaging in Social Activities).</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="a-second-example-no-autism-diagnosis-present">A second example, no autism diagnosis present<a class="anchor" aria-label="anchor" href="#a-second-example-no-autism-diagnosis-present"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqspf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"pdfs"</span>, <span class="st">"de-identified+report+1.pdf"</span>, package<span class="op">=</span><span class="st">"llm4np"</span><span class="op">)</span></span>
<span><span class="va">sq</span> <span class="op">=</span> <span class="fu"><a href="../reference/parse_nppdf.html">parse_nppdf</a></span><span class="op">(</span><span class="va">sqspf</span><span class="op">)</span></span>
<span><span class="va">txt2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\n"</span>, <span class="st">" "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">sq</span><span class="op">@</span><span class="va">text</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">)</span>  <span class="co"># concatenate text</span></span>
<span><span class="va">prompted_agent</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>txt<span class="op">=</span><span class="va">txt2</span>, df<span class="op">=</span><span class="va">nmdf</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">pretty_rmd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Joe is an 8-year-old boy with a history of premature birth, Tourette syndrome, and ADHD. His current neuropsychological evaluation aimed to clarify his cognitive and behavioral functioning, as increased concerns about his attention and academic progress have arisen since his last evaluation at age 6. Joe is notably engaged and cooperative but struggles with attention regulation, which negatively impacts his school performance and learning.</p>
<p>Test results revealed that Joe’s cognitive abilities are in the borderline range, with challenges in attention and executive function affecting task performance. Despite some improvements since his last evaluation, such as enhanced verbal skills, Joe continues to show deficits in working memory, task organization, and fine motor skills. His performance is particularly affected by complex tasks that demand simultaneous operations.</p>
<p>Parents and teachers observe that Joe has made progress in social interactions and has fewer hyperactive behaviors than in the past. However, his attention problems remain persistent, as evidenced by difficulties with task initiation and maintaining focus, which significantly affect his learning and daily activities. Sleep issues and behavioral concerns also persist, prompting the need for intervention strategies.</p>
<p>Recommendations suggest continued small-group instructional support, daily practice of routines, and the use of external modeling for Joe. Incorporating breaks, preferential seating, and ensuring he has structured and manageable workloads are critical for creating a conducive learning environment. Regular check-ins with teachers can further assist Joe in staying focused during class.</p>
<p>The overall impression indicates that Joe remains at risk for ongoing academic and functional difficulties, necessitating collaborative efforts among his medical, educational, and familial support systems. A follow-up assessment is advised in two years to monitor his progress.</p>
<p>Strengths: Engaging and cooperative, verbal skills, social interactions, reduction in hyperactivity.</p>
<p>Weaknesses: Attention regulation, working memory deficits, organizational skills, fine motor skills.</p>
<p>Needs: Small-group instructional support, routine practice, breaks during tasks, collaborative support from educational and medical teams.</p>
</blockquote>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vince Carey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
